<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=320, user-scalable=no" />
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<title>NFC</title>
<link rel="stylesheet" href="css/index.css" type="text/css" media="screen" title="no title" charset="utf-8">
</head>

<body>
    <div id="screen-1" class="screen">
        <h1>Какво е NFC?</h1>
        <p>Near field communication (комуникация на къси разстояния), накратко NFC, е вид безконтактна комуникация между устройства като смарт телефони или таблети. Безконтактната комуникация позволява на потребителя да помаха с телефон покрай съвместимо с NFC устройство, за да изпрати информацията, без да се налага докосване на устройствата или конфигуриране на връзката с няколко стъпки.</p>

        <h1>Ключови характеристики на NFC</h1>
        <ul>
            <li>Безжична технология за комуникация</li>
            <li>Малък обхват (не повече от 4 см за мобилни устройства)</li>
            <li>Работна честота 13.56 MHz</li>
            <li>Висока скорост (106-424 Kb/s)</li>
            <li>Настройка с едно докосване (улеснено свързване на устройствата) = 0.1 секунди</li>
            <li>Пасивни (без батерии) електронни стикери (тагове), с които се свързва мобилния телефон и комуникира.</li>
        </ul>

        <h1>Начин на работа</h1>
        <p>Подобно на Wi-Fi, Bluetooth и други безжични начини за комуникация, NFC работи на принципа на изпращане на информация чрез радиовълни.</p>
        <p>Също като RFID стандартите 14443 и FeliCa, NFC също използва индуктивното свързване. Подобно на принципа на трансформатора, магнитното поле на две проводникови бобини се използва, за да свърже избирателното устройство (инициатора) и слушащото устройство (мишената).</p>
        <img src="img/how-work.png" alt="how work">
        <p>Конфигурация на устройства инициатор и мишена</p>

        <h1>Режими на работа на устройствата</h1>
        <ul>
            <li><span class="bold">Пасивен</span> – устройството инициатор осигурява пренасящо поле, което пасивното устройство модулира. В този режим пасивното устройство може да черпи необходимото си захранване от осигуреното от активното устройство електромагнитно поле. Така пасивното устройство едновременно приема и излъчва радио сигнал.</li>
            <li><span class="bold">Активен, също познат като peer-to-peer</span> – двете устройства комуникират като се редуват да генерират електромагнитни полета. Устройството изключва полето си, докато чака за информация. В този режим обикновено и двете устройства имат собствени електрозахранвания.</li>
        </ul>

        <h1>Уязвимости</h1>
        <p>Технологията NFC може да бъде ефективна в много области, но въпреки че обмяната на сигнала става на много близки разстояния, тя може да бъде уязвима. Основните методи на атака срещу NFC технологията са:</p>
        <ul>
            <li>подслушване</li>
            <li>промяна на данните</li>
            <li>man in the middle (MITM, на български: човек по средата)</li>
            <li>пренасочваща атака</li>
            <li>data corruption</li>
            <li>измама </li>
        </ul>

        <h1>Възможности на NFC</h1>
        <p>Поддръжката на NFC в мобилните устройства позволява на потребителите им да обменят почти всички видове информация с други устройства поддържащи NFC. Чрез NFC може да се обменя между устройствата видео клипове, изображения и други видове файлове, може да се обменят уеб страници, бележки и друг вид информация. Чрез мобилно устройство поддържащо NFC може да се извършват и безконтактни плащания.</p>
        <p>Чрез мобилните устройства разполагащи с NFC може да се извършва контрол на достъпа. NFC може да замени картите и чиповете за достъп. Мобилно устройство с NFC може да отключва домовете ни, колите ни, може да включва уредите ни. NFC може и да се използва и за достъп до допълнителна информация, като например промоции за различни отстъпки или списък от намиращи се в близост до дадена местност обекти чрез доближаване на мобилното устройство до NFC таг и прочитането му.</p>

        <h1>NFC таговете</h1>
        <p>NFC таг е малък микрочип, който съдържа памет и технология, която му позволява да комуникира. Към него е прикрепена антена. Тя представлява намотка. Корпусът ги държи заедно и обикновено представлява тънък слой пластмаса.</p>
        <p>Добавянето на информация към NFC тага се нарича кодиране. Има огромно разнообразие от видове информация, която може да бъде кодирана до NFC таг. Например може да коридате уеб адрес, телефонен номер или просто идентификационен номер. Информацията обикновено се съхранява в точно определен вид NDEF (NFC формат за обмен на данни).</p>
        <p>Количеството данни, които може да съхранява NFC, зависи от вида. В сравнение с други устройства с памет (USB, SD карта), капацитетът на NFC е сравнително малък.</p>

        <div class="btn-line">
            <div class="btn btn-next">Напред</div>
        </div>
    </div>

    <div id="screen-2" class="screen">
        <h1>Структура на съобщението</h1>

        <h2>Структура на NDEF</h2>
        <p>NDEF е бинарен формат структуриран в съобщения, всяко от което може да съдържа няколко записа. Всеки запис има заглавна част (header), която съдържа мета информация за записа, като например типа на записа, дължината и т.н. и полезен товар (payload), който държи съдържанието на съобщението.</p>
        <p>NFC транзакциите по принцип са кратки. Всяка обмяна съдържа само едно съобщение и всеки таг носи само едно такова.</p>
        <img src="img/structure-NDEF-message-several-records.png" alt="The structure of an NDEF message made up of several records">
        <p>Структура на NDEF съобщение, съставено от няколко записа; това е типичен пример - адресна книга с три записа (име, телефон, адрес)</p>
        <p>Един NDEF запис съдържа товар с данни и мета информация, описваща как да се интерпретират данните. Всеки товар на запис може да е един от няколко различни типа данни. Заглавната част на всеки запис съдържа метадата, която описва записа и мястото му в съобщението, последвано от типа му и уникален идентификатор (ID). След заглавната част идва товара.</p>
        <img src="img/NDEF-message-structure-with-details.png" alt="NDEF message structure, with details about the bytes of the header">
        <p>Структура на NDEF съобщение с детайли за байтовете на заглавната част</p>
        <p>Както се вижда на фигурата, NDEF записът съдържа име на типа формат (TNF, Type Name Format), тип на товара, идентификатор на товара и самия товар. Товарът е най-важната част в NDEF записите – предава се неговото съдържание. Типът на товара е NFC специфичен тип, MIME медиен тип или URI, който казва как да се интерпретира товара. Идентификаторът на товара не е задължителен.</p>

        <h3>Тип на формата</h3>
        <p>NEDF записите започват с име на типа формата. TNF показва структурата на стойността на полето за тип и как да се интерпретира. Има няколко възможни TNF стойности:</p>
        <ol>
            <li><span class="bold">Празен (Empty)</span> – празен запис, който няма тип или товар.</li>
            <li><span class="bold">Добре познат (Well-Known)</span> – един от няколко предефинирани типа в NFC форумната спецификация.</li>
            <li><span class="bold">MIME медиен тип</span> - интернет медиен тип, както е дефиниран в RFC 2046.</li>
            <li><span class="bold">Абсолютен URI</span> – URI, както е дефиниран в RFC 3986.</li>
            <li><span class="bold">Външен</span> – дефинирана от потребителя стойност, базирана на правилата в NFC форумната дефиниция за тип.</li>
            <li><span class="bold">Непознат (Unknown)</span> – типът е непознат. Дължината трябва да е 0.</li>
            <li><span class="bold">Непроменен</span> – само за средните и последни записи на записи. Дължината на типа трябва да е 0.</li>
            <li><span class="bold">Запазен</span> - запазен за бъдещи употреби от NFC форума.</li>
        </ol>

        <h3>Тип на товара</h3>
        <p>Типът на товара, както и типа на записа, описва съдържанието на товара в детайли. TNT дефинира формата на типа на товара. Типът може да е не NDEF специфичен тип, MIME тип, URI или външен тип. Дефиницията за NDEF тип на записа (RTD) описва добре познатите типове за запис и задава правилата за създаване на външни типове. RFC за MIME и URI RFC задават правилата за останалите типове.</p>

        <h3>Товар</h3>
        <p>Товарът е съдържанието на съобщението. Може да е всичко, което се побира в поредица байтове. Една добре структурирана NDEF библиотека не се интересува от това какво има в товара, просто го предава. Може да се енкрипне товара, да се изпрати чист текст или каквото ви дойде на ум.</p>

        <h3>Структура на записа</h3>
        <p>Първите пет бита от NDEF записа са флагове, които казват как да се прочете записа и дават информация за мястото на записа в съобщението.</p>
        <p>Флаговете в първия бит на главната част записа са както следва:</p>
        <ul>
            <li><span class="bold">MB (Message Begin, Съобщението започва)</span> - това е вярно, когато това е първия запис на съобщението.</li>
            <li><span class="bold">ME (Message End, Съобщението свършва)</span> - вярно, когато това е последния запис от съобщението.</li>
            <li><span class="bold">CF (Chunk Flag, Флаг за накъсаност)</span> - истина, когато записа е на парчета.</li>
            <li><span class="bold">SR (Short Record, Къс запис)</span> - вярно ако е ползван къс формат на записа за дължина на товара.</li>
            <li><span class="bold">IL (ID Length is present, Има идентификатор за дължината)</span> - вярно, ако има идентификатор за полето дължина.</li>
        </ul>

        <h3>Заглавна част на записа</h3>
        <p>NDEF записите са вариращи по дължина структури от данни. Заглавната част на записа съдържа информацията, необходима за прочитане на данните.</p>
        <p>Един NDEF запис започва с TNT байт, който включва и битовите флагове. След него е дължината на типа, която е поле от един байт и определя дължината на типа на товара в байтове. Дължината на полето е задължителна, но може да е 0.</p>
        <p>Следва дължината на товара. Флагът за кратък запис е в първия байт и определя дължината на товара на записа. Ако SR е истина, дължината е един байт, иначе е четири байта. Дължината на товара е задължителна, но може да е 0.</p>
        <p>Ако IL флагът е истина, следва идентификаторът за дължина.</p>
        <p>Полето за тип на записа е с променлива дължина след идентификаторът за дължина. Дължината на типа определя колко байта трябва да бъдат прочетени.</p>
        <p>Ако има идентификатор на записа, идва след типа. Дължината на полето зависи от идентификатора за дължина.</p>
        <p>Това е краят на заглавната част. Следва товарът.</p>

        <h3>Колко голямо може да бъде едно NDEF съобщение?</h3>
        <p>Размерът на товарите на NDEF записите е ограничен до 232-1 байта, поради което дължината на заглавната част е четири байта (или 232 бита). Обаче записите могат да се навържат заедно в съобщение и да формират по-големи товари. На теория няма лимит в дължината на едно NDEF съобщение. На практика, възможностите на устройствата и таговете създават ограниченията. Ако се обменят съобщения по peer-to-peer между две устройства, единствените ограничения са нивата на батерия на устройствата и търпението на хората, които ги държат. Ако комуникацията е между устройство и телефон обаче, ограничението е в това колко е паметта на тага.</p>

        <div class="btn-line">
            <div class="btn btn-prev">Назад</div>
            <div class="flex-baloon"></div>
            <div class="btn btn-next">Напред</div>
        </div>
    </div>

    <div id="screen-3" class="screen">
            <h1>Примери за създаване на запис на NFC таг</h1>
            <h2>MIME MEDIA</h2>

            <div class="example-write-type">
                <p class="bold">ТЕКСТ</p>
                <p>TNT: Mime Media</p>
                <p>mimeType: text/pg</p>
                <p>пример за payload: Hello World</p>
            </div>

            <div class="example-write-type">
                    <p class="bold">ТЕКСТ</p>
                    <p>TNT: Mime Media</p>
                    <p>mimeType: text/plain</p>
                    <p>пример за payload: Hello World</p>
            </div>

            <div class="example-write-type">
                    <p class="bold">ВИЗИТНА КАРТИЧКА</p>
                    <p>TNT: Mime Media</p>
                    <p>mimeType: text/vcard</p>
                    <p>пример за payload:</p>
                    <div class="text-indent">
                        <p>BEGIN:VCARD</p>
                        <p>VERSION:2.1</p>
                        <p>N:Doe;John;;;</p>
                        <p>FN:John Doe</p>
                        <p>ORG:DoeDesign;</p>
                        <p>URL:https://doe-design.com</p>
                        <p>TEL;WORK:135-758-0034</p>
                        <p>EMAIL;WORK: johndoe@doe-design.com</p>
                        <p>END:VCARD</p>
                    </div>
            </div>

            <div class="example-write-type">
                    <p class="bold">ПРАЗЕН ЗАПИС / ИЗТРИВАНЕ НА ТАГ</p>
                    <p>TNT: Mime Media</p>
                    <p>mimeType: ''</p>
                    <p>пример за payload: ''</p>
            </div>

            <div class="example-write-type">
                    <p class="bold">ТЕКСТ</p>
                    <p>TNT: Well Known</p>
                    <p>тип: T</p>
                    <p>пример за payload: test 123</p>
            </div>

            <div class="example-write-type">
                    <p class="bold">ЛИНК</p>
                    <p>TNT: Well Known</p>
                    <p>тип: U</p>
                    <p>пример за payload: https://www.google.com/</p>
            </div>

            <div class="btn-line">
                <div class="btn btn-prev">Назад</div>
                <div class="flex-baloon"></div>
                <div class="btn btn-next">Напред</div>
            </div>
    </div>

    <div id="screen-4" class="screen">
        <h1>Записване на NFC таг</h1>

        <form>
            TNF:<br/>
            <label>
                <input id="mimeMedia1" type="radio" name="tnf-1" value="mime" /> Mime Media
            </label><br/>
            <label>
                <input type="radio" name="tnf-1" value="well" />Well Known
            </label><br/><br/><br/>
            Тип на данните:<br/>
            <input type="text" name="mimeType" value="" size="30" /><br/><br/><br/>
            Данни:<br/>
            <textarea name="payload" rows="10" cols="30"></textarea><br/>
        </form>
        <p>
            Доближете NFC таг, за да запишете данните.
        </p>

        <div class="btn-line">
            <div class="btn btn-prev">Назад</div>
            <div class="flex-baloon"></div>
            <div class="btn btn-next">Напред</div>
        </div>
    </div>

    <div id="screen-5" class="screen">
        <h1>Четене от NFC таг</h1>

        <div id="tagContents">
            <div class="spinner">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
            </div>
            <div class="hidden">
                Доближете NFC таг.
            </div>
        </div>

        <div class="btn-line">
            <div class="btn btn-prev">Назад</div>
            <div class="flex-baloon"></div>
            <div class="btn btn-next">Напред</div>
        </div>
    </div>

    <div id="screen-6" class="screen">
        <h1>Режим peer-to-peer</h1>

        <form>
            TNF:<br/>
            <label>
                <input id="mimeMedia2" type="radio" name="tnf-2" value="mime" /> Mime Media
            </label><br/>
            <label>
                <input type="radio" name="tnf-2" value="well" />Well Known
            </label><br/><br/><br/>
            Mime Type:<br/>
                <input type="text" name="mimeType" value="" size="30" /><br/><br/>
            Данни:<br/>
            <textarea name="payload" rows="10" cols="30"></textarea><br/>
            <br/>
            <input type="checkbox" name="share" id="checkbox" value="Share"/><label for="checkbox">Сподели съобщението</label>
        </form>
        <div id="statusDiv">Доближете NFC устройство, за да споделите</div>

        <div class="btn-line">
            <div class="btn btn-prev">Назад</div>
            <div class="flex-baloon"></div>
        </div>
    </div>

    <script id="non-ndef-template" type="text/x-handlebars-template">
        <p>Прочетен е не-NDEF NFC таг</p>
        <p>
            Таг ID: <strong>{{ bytesToHexString id }}</strong>
        </p>
    </script>

    <script id="tag-template" type="text/x-handlebars-template">
        <p>Прочетен е NDEF таг с {{ ndefMessage.length }} {{ pluralize ndefMessage.length 'запис' 'записа' }}</p>

        {{!
            BB10 and WP8 will not have any meta info
            Android P2P will not have id, but will have type
        }}
        <dl>
            {{#if id}}
            <dt>Таг ID</dt>             <dd>{{ bytesToHexString id }}</dd>
            {{/if}}

            {{#if type}}
            <dt>Тип на тага</dt>           <dd>{{ type }}</dd>
            {{/if}}

            {{#if maxSize }}
            <dt>Максимален размер</dt>           <dd>{{ maxSize }} bytes</dd>
            {{/if}}

            {{#if freeSpaceSize }}
            <dt>Свободно пространство</dt>         <dd>{{ freeSpaceSize }} bytes</dd>
            {{/if}}

            {{#if id}}
            <dt>Програмируем</dt>        <dd>{{ toString isWritable }}</dd>
            <dt>Може да се направи само за четене</dt> <dd>{{ toString canMakeReadOnly }}</dd>
            {{/if}}
        </dl>

        {{#each ndefMessage}}  {{! does not read well, iterating on records non messages}}
        <div class='record'>
            Запис {{ @index }}:<br/>
            TNF: <b>{{ tnfToString tnf }}</b><br/>
            {{#if tnf}}
                Вид на записа: <b>{{ bytesToString type }}</b><br/>
                Данни: <b>{{ decodePayload this }}</b><br/>
                {{#if id}}
                    Запис ID: <b>{{ bytesToString id }}</b><br/>
                {{/if}}
            {{/if}}
        </div>
        {{/each}}
    </script>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/handlebars.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>
</body>
</html>
